@startuml EKA_Container

' Configuraci√≥n de fondo ANTES de incluir C4
skinparam backgroundColor #0D1117

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

' Metadata
title EKA System - Container Diagram

' ---------------------------------------------------------
' ESQUEMA DE COLORES PERSONALIZADO
' ---------------------------------------------------------
' Colores modernos y profesionales
!$PRIMARY_COLOR = "#2F81F7"
!$SECONDARY_COLOR = "#ffffffff"
!$EXTERNAL_COLOR = "#475569"
!$PERSON_COLOR = "#F59E0B"
!$ACCENT_COLOR = "#C73E1D"
!$CONTAINER_WEB = "#10B981"
!$CONTAINER_API = "#8B5CF6"
!$CONTAINER_DB = "#EC4899"

' Actualizar estilos de elementos con bordes redondeados
UpdateElementStyle("person", $bgColor=$PERSON_COLOR, $fontColor="#FFFFFF", $borderColor="#B45309", $shape=RoundedBoxShape())
UpdateElementStyle("container", $bgColor=$CONTAINER_API, $fontColor="#FFFFFF", $borderColor="#6D28D9", $shape=RoundedBoxShape())
UpdateElementStyle("external_system", $bgColor=$EXTERNAL_COLOR, $fontColor="#FFFFFF", $borderColor="#334155", $shape=RoundedBoxShape())

' Colores de relaciones
UpdateRelStyle($lineColor=$SECONDARY_COLOR, $textColor=$SECONDARY_COLOR)

' Define custom styling
LAYOUT_WITH_LEGEND()

' ---------------------------------------------------------
' PERSONAS
' ---------------------------------------------------------
Person(user, "Professional User", "Users who need fast and trustworthy answers extracted from their documents")

' ---------------------------------------------------------
' SISTEMA EKA - CONTAINERS
' ---------------------------------------------------------
System_Boundary(eka, "EKA System") {
    Container(web_app, "Web Application", "Next.js, React, TypeScript", "Provides the user interface for document upload chat interaction and results visualization", $sprite="react")
    
    Container(api_gateway, "API Gateway", "FastAPI, Python", "Handles HTTP requests authentication and routes to appropriate services", $sprite="python")
    
    Container(auth_service, "Auth Module", "Python, JWT", "Manages user authentication authorization and session handling")
    
    Container(ai_service, "AI Processing Module", "Python, LangChain", "Orchestrates document processing chunking embedding generation and RAG pipeline")
    
    Container(document_processor, "Document Processor", "Python, PyMuPDF, python-docx", "Extracts and structures text from PDF DOCX and MD files")
    
    Container(vector_store, "Vector Store", "PostgreSQL + pgvector", "Stores document embeddings and metadata for semantic search")
    
    ContainerDb(app_db, "Application Database", "PostgreSQL", "Stores user accounts document registry and application state")
}

' ---------------------------------------------------------
' SISTEMAS EXTERNOS
' ---------------------------------------------------------
System_Ext(voyage_ai, "Voyage AI", "External embeddings service that converts text chunks into 1024-dimensional vectors")
System_Ext(openai, "OpenAI GPT", "Language model service that generates context-aware answers from retrieved chunks")
System_Ext(file_storage, "File Storage", "Local/Cloud storage for uploaded document files")

' ---------------------------------------------------------
' RELACIONES - USER TO CONTAINERS
' ---------------------------------------------------------
Rel(user, web_app, "Interacts with", "HTTPS/WebSocket")

' ---------------------------------------------------------
' RELACIONES - WEB APP TO API
' ---------------------------------------------------------
Rel(web_app, api_gateway, "Makes API calls", "HTTPS/REST JSON")

' ---------------------------------------------------------
' RELACIONES - API GATEWAY TO MODULES
' ---------------------------------------------------------
Rel(api_gateway, auth_service, "Authenticates requests", "Function calls")
Rel(api_gateway, ai_service, "Routes AI requests", "Function calls")

' ---------------------------------------------------------
' RELACIONES - AUTH TO DATABASE
' ---------------------------------------------------------
Rel(auth_service, app_db, "Reads/writes user data", "SQL")

' ---------------------------------------------------------
' RELACIONES - AI SERVICE INTERNAL
' ---------------------------------------------------------
Rel(ai_service, document_processor, "Sends files for processing", "Function calls")
Rel(ai_service, vector_store, "Stores and queries embeddings", "SQL + Vector operations")
Rel(ai_service, app_db, "Registers documents", "SQL")

' ---------------------------------------------------------
' RELACIONES - DOCUMENT PROCESSOR
' ---------------------------------------------------------
Rel(document_processor, file_storage, "Reads uploaded files", "File I/O")

' ---------------------------------------------------------
' RELACIONES - AI TO EXTERNAL SERVICES
' ---------------------------------------------------------
Rel(ai_service, voyage_ai, "Requests embeddings", "HTTPS/REST API")
Rel(ai_service, openai, "Sends prompts with context", "HTTPS/REST API")

' Footer with additional information
SHOW_LEGEND()

@enduml

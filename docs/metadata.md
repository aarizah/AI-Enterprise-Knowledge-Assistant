### Metadata
**AI/chunking/utils** → Creates base metadata per file (e.g., `source`, `type`) and creates a watermark to know the page of each chunk in the next step.

**AI/chunking/chunking** → Adds Markdown structure metadata (`h1`, `h2`, `h3`) when it exists, adds page metadata (`page`, `total_pages`). It also preserves the previous metadata.

**Final metadata (per chunk):**
- **source**: file name (e.g., `manual.pdf`, `doc.docx`)
- **type**: file type (`pdf`, `docx`, `md`)
- **page**: REAL page number, 1-indexed (for `pdf` and `docx`)
- **total_pages**: total number of pages (for `pdf` and `docx`)
- **h1/h2/h3**: detected headers (if any)
- **split_id**: index of the sub-chunk generated by the `TokenTextSplitter`

**Notes:**
- **PDF**: a single `Document` is generated with internal page markers; header-based chunking calculates `page` as the starting page of the chunk. `total_pages` comes from the document metadata.
- **DOCX**: automatically converted to a temporary PDF to obtain REAL pagination and then processed like a PDF (a single `Document` with markers). Requires:
  - **Windows**: `docx2pdf` (uses Word COM)
  - **Linux/Mac**: `libreoffice` installed
  - If no converter is available, it processes without `page` (fallback)
- **MD**: has no pagination; does not include `page`.
